# 线性阵型战斗系统 - 完整功能说明

## 系统概述

本系统将原有的左右对战阵型改为从左到右的线性阵型布局，实现了基于位置的战术战斗和自动挂机探索模式。

## 核心设计理念

### 线性布局结构

```
位置索引: 0  1  2  3  4  5  6  7  8  9  10 11
布局:    玩家后排  →  玩家前排 → 敌人前排 → 敌人后排
```

**具体位置分配：**

- 位置 0-2: 玩家后排 (PlayerBackLeft/Center/Right)
- 位置 3-5: 玩家前排 (PlayerFrontLeft/Center/Right)
- 位置 6-8: 敌人前排 (EnemyFrontLeft/Center/Right)
- 位置 9-11: 敌人后排 (EnemyBackLeft/Center/Right)

## 核心系统组件

### 1. HorizontalFormationTypes.cs - 阵型类型定义

**功能：**

- 定义 12 个线性位置的枚举
- 提供位置间距离计算
- 实现职业最优位置算法
- 支持线性攻击范围判定

**关键方法：**

- `GetLinearDistance()` - 计算线性距离
- `CanMeleeAttack()` - 近战攻击判定 (距离 ≤1)
- `CanRangedAttack()` - 远程攻击判定 (无距离限制)
- `GetWorldPosition()` - 获取 3D 世界坐标

### 2. HorizontalCombatRules.cs - 战斗规则

**功能：**

- 基于线性距离的攻击规则
- 近战/远程/法术目标筛选
- 考虑掩护效果的攻击计算

**攻击规则：**

- **近战攻击**: 只能攻击距离 ≤1 的敌人
- **远程攻击**: 可攻击任何距离的敌人，但受掩护影响
- **法术攻击**: 根据法术类型选择目标

### 3. HorizontalCoverSystem.cs - 掩护系统

**功能：**

- 基于线性阻挡的掩护计算
- 多层掩护效果累积
- 动态掩护强度判定

**掩护类型：**

- **无掩护**: 直接攻击
- **半掩护**: 1 个阻挡者，+2 AC
- **四分之三掩护**: 2 个阻挡者，+5 AC
- **完全掩护**: 3+个阻挡者，无法攻击

### 4. HorizontalStealthComponent.cs - 盗贼潜行

**功能：**

- 潜行状态管理
- 背刺机动 (移动到敌人后排)
- 潜行检定和察觉对抗

**潜行机制：**

1. **进入潜行**: 通过技能检定
2. **背刺机动**: 移动到敌人后排位置
3. **背刺攻击**: 获得优势和额外伤害

### 5. BattleFormationManager.cs - 阵型管理

**功能：**

- 12 个线性位置的管理
- 角色自动站位算法
- 位置占用状态追踪
- 动态位置调整

**站位策略：**

- **坦克职业** (战士/圣武士): 优先前排
- **法师职业** (法师/术士): 优先后排中央
- **辅助职业** (牧师): 后排侧翼
- **机动职业** (盗贼/游侠): 前排侧翼或后排

### 6. AutoBattleAI.cs - 自动战斗 AI

**功能：**

- 智能战斗决策系统
- 多优先级行动评估
- 职业特色技能运用

**AI 决策优先级：**

1. **治疗优先** (0.8): 拯救濒死盟友
2. **攻击优先** (0.7): 消灭敌人
3. **站位优先** (0.6): 调整战术位置
4. **防御优先** (0.5): 防护措施

**特殊 AI 行为：**

- **盗贼 AI**: 自动潜行 → 背刺 combo
- **法师 AI**: 优先范围法术，考虑法术位消耗
- **治疗 AI**: 血量阈值智能治疗
- **坦克 AI**: 保护后排，优先强攻

### 7. IdleGameManager.cs - 挂机系统

**功能：**

- 无人值守的自动探索
- 阶段式进度推进
- 随机遭遇战斗
- 经验金币奖励累积

**挂机流程：**

1. **探索阶段**: 自动推进进度条
2. **随机遭遇**: 定期触发战斗
3. **自动战斗**: AI 控制整个战斗过程
4. **奖励结算**: 自动分配经验和金币
5. **失败处理**: 队伍休息机制

**阶段系统：**

- 每阶段多个波次
- 逐步提升敌人等级
- 渐进式奖励增长

### 8. LinearFormationDemo.cs - 演示系统

**功能：**

- 完整系统功能展示
- 分步骤教学演示
- 可视化位置标记
- 实时 AI 思考过程

## 战术特色

### 距离战术

- **近战冲锋**: 前排角色快速接敌
- **远程压制**: 后排持续火力输出
- **机动穿插**: 盗贼潜行到敌后

### 掩护战术

- **人墙保护**: 前排为后排提供掩护
- **交叉火力**: 利用阵型空隙攻击
- **突破包围**: 集中火力打开缺口

### 职业配合

- **坦克+治疗**: 前排抗伤+后排治疗
- **法师+保护**: 后排输出+前排掩护
- **盗贼+牵制**: 背刺干扰+正面佯攻

## 挂机游戏特色

### 类《巴尔的遗产》体验

- **无脑挂机**: 完全自动化战斗
- **策略深度**: 阵型站位影响战果
- **持续成长**: 角色等级装备提升
- **多样化敌人**: 不同阶段不同挑战

### 数值平衡

- **DND5E 规则**: 保持原版数值体系
- **适度简化**: 降低操作复杂度
- **策略保留**: 保持战术决策意义

## 使用指南

### 开发者集成

1. 将 HorizontalFormation 文件夹导入项目
2. 在场景中添加 BattleFormationManager
3. 配置角色预制体和位置 Transform
4. 启用 AutoBattleAI 和 IdleGameManager

### 玩家体验

1. 组建 4 人冒险队伍
2. 启动挂机模式
3. 观察 AI 自动战斗
4. 享受放置游戏乐趣

### 自定义扩展

- **新职业**: 扩展职业 AI 行为
- **新技能**: 添加特殊能力判定
- **新敌人**: 丰富遭遇类型
- **新阶段**: 增加探索内容

## 技术亮点

1. **完全兼容现有 DND5E 系统**
2. **零手动操作的挂机体验**
3. **基于真实距离的战术计算**
4. **多层掩护效果的物理模拟**
5. **职业特色鲜明的 AI 决策**
6. **可扩展的阶段探索系统**

## 总结

线性阵型系统成功地将传统 DND5E 战斗转换为现代挂机游戏模式，在保持策略深度的同时实现了完全自动化。玩家可以享受阵型布局的策略乐趣，同时体验无脑挂机的轻松娱乐。

系统具有良好的可扩展性，可以轻松添加新职业、新技能、新敌人和新阶段，为长期游戏体验提供了坚实基础。

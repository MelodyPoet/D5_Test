# DND5E 系统 - 工程编码规范

## 📋 核心开发原则

### 🔒 **文档保护和管理规范**

- **绝对禁止删除本文档**：DEVELOPMENT_STANDARDS.md 是项目核心规范，严禁删除或移动
- **唯一文档原则**：所有业务逻辑规则、Unity 配置说明、手动设置指南均记录在本文档中
- **禁止创建其他文档**：不允许创建任何其他.md 技术文档或设置指南
- **文档集中管理**：本文档作为项目唯一技术标准和操作手册

### 📝 **文档内容管理规范**

- **禁止记录临时内容**：不得在文档中记录逻辑更新过程、debug 调试记录等临时性内容
- **禁止过程日志**：不得记录开发过程中的修改历史、错误排查过程等流水账
- **仅记录核心规范**：只记录核心开发原则、配置标准、架构规范等永久性规则
- **保持文档简洁**：文档应聚焦于当前有效的技术标准，避免冗余信息

---

## 🎯 **开发行为规范**

### 🔧 **功能实现设计规范**

- **单一设计原则**：实现功能时只提供一种设计方案，不提供多套方案供选择
- **禁止方案选择**：严禁设计 2 套或多套方案让用户选择实现方式
- **直接实现**：基于最佳实践直接提供最优方案，一次性完成实现
- **迭代改进**：如果方案不够好，用户会明确要求设计新方案，此时才进行重新设计

### 🚫 **Git 操作限制规范**

- **禁止自动推送**：严禁自动执行 `git push` 操作到 GitHub 仓库
- **禁止主动推送**：不得主动进行代码推送到远程仓库
- **仅限本地操作**：只允许执行 `git add`、`git commit` 等本地 Git 操作
- **异常处理**：只有当用户手动推送遇到问题时，才协助解决推送相关技术问题

### 🗣️ **对话语言规范**

- **强制要求**：与用户的所有对话必须使用**中文**
- **代码注释**：所有代码注释必须使用中文
- **变量命名**：使用英文命名规范（驼峰命名法等）
- **文档内容**：所有.md 文档内容使用中文
- **严禁行为**：因为用户点击英文按钮选项而切换成英文回复
- **严禁行为**：在任何情况下使用英文与用户交流（除非是代码本身的关键字）

---

## ⚠️ **严格禁止项**

### 🚨 **禁止创建的文件类型**

```
❌ XXXTester.cs         - 测试脚本
❌ XXXDemo.cs           - 演示脚本
❌ XXXSetupWizard.cs    - 设置向导
❌ XXXChecker.cs        - 检查器
❌ XXXValidator.cs      - 验证器
❌ QuickSetupXXX.cs     - 快速设置
❌ AutoXXX.cs           - 自动化工具
❌ XXXTestManager.cs    - 测试管理器
❌ XXX_Fixed.cs         - 修复版本文件
❌ XXX_Backup.cs        - 备份文件
❌ XXX_Old.cs           - 旧版本文件
❌ 空文件或仅包含注释的文件
```

### 🛠️ **代码质量要求**

- **强制错误清理**：严禁在 IDE 的 PROBLEMS 面板有任何报错的情况下声称功能完成
- **全项目编译检查**：必须解决项目中所有脚本的编译错误，不论是否与当前任务直接相关
- **配置方法单一化**：每个配置项仅提供一种最直接、最可靠的配置方法
- **弃用代码强制删除**：严禁保留任何标记为[System.Obsolete]的方法、类或属性

---

## 🎮 **游戏系统架构**

### 🏗️ **横版 2D DND5E 战斗系统**

本项目是一个 Unity 横版 2D 战斗游戏，实现了完整的 DND5E 规则系统和自动挂机模式。

#### **核心游戏模式**

- **挂机模式**: 全自动探索、遭遇、战斗循环
- **横版布局**: 玩家在左侧，敌人在右侧的经典对战布局
- **DND5E 规则**: 完整的角色属性、技能、法术系统
- **动画系统**: 基于 Spine 的角色动画，支持走路、空闲、攻击等状态

#### **核心系统组件（强关联架构）**

```
✅ IdleGameManager.cs                    - 挂机游戏主管理器（核心）
✅ HorizontalBattleFormationManager.cs  - 横版阵型管理器（核心）
✅ AutoBattleAI.cs                      - 自动战斗AI系统（核心）
✅ CharacterStats.cs                    - 角色属性系统
✅ Role.cs                              - 角色动画控制组件
```

**强关联关系**:

- IdleGameManager 必须引用 HorizontalBattleFormationManager
- IdleGameManager 必须引用 AutoBattleAI
- 三个核心组件必须在同一场景中手动挂载
- 不使用任何自动创建或查找逻辑

---

## 🛠️ **Unity 手动挂载设置指南**

### 📁 **标准 Hierarchy 结构**

```
Hierarchy结构:
├── IdleGameSystem (空GameObject)
│   ├── IdleGameManager (手动添加IdleGameManager脚本)
│   ├── HorizontalBattleFormationManager (手动添加HorizontalBattleFormationManager脚本)
│   └── AutoBattleAI (手动添加AutoBattleAI脚本)
├── Characters (空GameObject，角色容器)
│   ├── PlayerParty (空GameObject，运行时角色父对象)
│   └── EnemyParty (空GameObject，运行时角色父对象)
└── Environment (空GameObject，背景容器)
    └── Background (背景图片或滚动脚本)
```

### ⚙️ **组件配置设置**

#### **1. IdleGameManager 配置**

```csharp
[挂机模式设置]
✅ idleModeEnabled = false (启动时需手动开启)
✅ encounterInterval = 10.0f (遭遇间隔时间)
✅ battleSpeed = 1.0f (战斗速度倍率)

[探索设置]
✅ currentStage = 1 (当前关卡)
✅ currentWave = 1 (当前波次)
✅ stageProgressPercent = 0f (关卡进度百分比)

[队伍生成设置]
✅ useFormationManager = true (使用阵型管理器生成队伍)
✅ playerPartySize = 3 (玩家队伍人数上限，推荐1-6人)

[系统组件 - 强制手动引用]
✅ formationManager: 手动拖入同场景中的HorizontalBattleFormationManager组件
✅ autoBattleAI: 手动拖入同场景中的AutoBattleAI组件
```

#### **2. HorizontalBattleFormationManager 配置**

```csharp
[🔵 玩家阵型配置 (左侧)]
前排:
✅ 玩家前排左翼: 拖入玩家前排左翼角色预制体
✅ 玩家前排中锋: 拖入玩家前排中锋角色预制体
✅ 玩家前排右翼: 拖入玩家前排右翼角色预制体

后排:
✅ 玩家后排左翼: 拖入玩家后排左翼角色预制体
✅ 玩家后排中路: 拖入玩家后排中路角色预制体
✅ 玩家后排右翼: 拖入玩家后排右翼角色预制体

[🔴 敌人阵型配置 (右侧)]
前排:
✅ 敌人前排左翼: 拖入敌人前排左翼角色预制体
✅ 敌人前排中锋: 拖入敌人前排中锋角色预制体
✅ 敌人前排右翼: 拖入敌人前排右翼角色预制体

后排:
✅ 敌人后排左翼: 拖入敌人后排左翼角色预制体
✅ 敌人后排中路: 拖入敌人后排中路角色预制体
✅ 敌人后排右翼: 拖入敌人后排右翼角色预制体

[⚙️ 阵型参数设置]
✅ battlefieldWidth = 20f
✅ battlefieldDepth = 4f
✅ positionSpacing = 2f
```

#### **3. AutoBattleAI 配置**

```csharp
✅ enableAutoBattle = true
✅ attackDamage = 15
✅ attackDelay = 1.0f
```

### 🎭 **动画系统管理**

#### **Role 组件动画状态**

```csharp
Role.ActState.IDLE    - 空闲动画 (战斗时使用)
Role.ActState.MOVE    - 走路动画 (探索时使用)
Role.ActState.ATTACK  - 攻击动画 (战斗行动时)
Role.ActState.HIT     - 受击动画 (被攻击时)
Role.ActState.DEAD    - 死亡动画 (角色死亡时)
```

#### **动画播放 API**

```csharp
// 播放指定动画
Role roleComponent = character.GetComponent<Role>();
roleComponent.playAct(Role.ActState.MOVE, "walk");  // 播放走路动画
roleComponent.playAct(Role.ActState.IDLE);          // 播放空闲动画
```

### 📐 **横版 2D 布局规范**

#### **坐标系统说明**

- **X 轴**: 左右对抗方向 (玩家在负值，敌人在正值)
- **Y 轴**: 排内左中右分布 (左翼 Y 大，右翼 Y 小)
- **Z 轴**: 固定为 0 (2D 游戏)

#### **标准阵型位置**

**玩家方(左侧)坐标:**

```
前排左翼: (-2.0, -2.0, 0)  // 前排，左翼
前排中锋: (-3.5, -4.0, 0)  // 前排，中路，向敌人突出
前排右翼: (-2.0, 0.0, 0)   // 前排，右翼

后排左翼: (-5.0, -2.0, 0)  // 后排，左翼
后排中路: (-5.0, -4.0, 0)  // 后排，中路
后排右翼: (-5.0, 0.0, 0)   // 后排，右翼
```

**敌人方(右侧)坐标:**

```
前排左翼: (2.0, -2.0, 0)   // 前排，左翼
前排中锋: (3.5, -4.0, 0)   // 前排，中路，向玩家突出
前排右翼: (2.0, 0.0, 0)    // 前排，右翼

后排左翼: (5.0, -2.0, 0)   // 后排，左翼
后排中路: (5.0, -4.0, 0)   // 后排，中路
后排右翼: (5.0, 0.0, 0)    // 后排，右翼
```

---

## 🚨 **违规检查清单**

### **功能完成前必须检查**

- [ ] 当前修改的脚本是否有编译错误？
- [ ] 整个项目的 PROBLEMS 面板是否显示 0 个错误？
- [ ] 是否存在跨脚本的引用错误或依赖问题？
- [ ] 所有相关脚本是否都能正常编译？
- [ ] 是否检查了命名冲突和类型定义问题？

### **配置设计前必须检查**

- [ ] 是否为每个配置项选择了唯一的实现方法？
- [ ] 是否避免了多重优先级的复杂配置逻辑？
- [ ] 是否选择了最不容易出错的配置方式？
- [ ] 配置路径是否足够简洁明确？

### **代码提交前必须检查**

- [ ] 是否清理了所有空文件和无效文件？
- [ ] 是否删除了所有测试、演示、验证类型的脚本？
- [ ] 是否移除了以\_Fixed、\_Backup、\_Old 等结尾的文件？
- [ ] 项目中是否只保留核心业务功能文件？
- [ ] 是否删除了所有[System.Obsolete]标记的代码？
- [ ] 是否清理了所有包含"弃用"、"已弃用"字样的注释？

---

## 📝 **总结**

**核心原则：严格手动挂载、强关联、单一路径、中文**

- 🎯 **强制手动挂载** - 所有组件引用必须手动设置，禁止自动查找
- 💪 **强关联关系** - IdleGameManager 必须引用 FormationManager 和 AutoBattleAI
- 🗑️ **删除弃用逻辑** - 移除 CombatManager、FindObjectOfType 等过时代码
- 📋 **单一配置路径** - 每个配置只有一种标准实现方式
- ✅ **质量第一** - 确保每个脚本都编译无误且功能完整
- 🗣️ **中文交流** - 所有对话、注释、文档均使用中文

**记住：统一手动挂载，强关联设计，删除弃用逻辑。**

---

_此规范文档记录核心开发标准，指导所有后续开发工作。_

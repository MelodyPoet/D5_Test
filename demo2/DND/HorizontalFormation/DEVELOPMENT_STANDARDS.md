# DND5E ç³»ç»Ÿ - å·¥ç¨‹ç¼–ç è§„èŒƒ

## ğŸ”’ **ä¸¥ç¦è¿åçš„æ ¸å¿ƒè§„åˆ™**

### **æ–‡æ¡£ç®¡ç†é“å¾‹**
- **å”¯ä¸€æŠ€æœ¯æ–‡æ¡£**ï¼šæœ¬æ–‡æ¡£æ˜¯é¡¹ç›®å”¯ä¸€çš„æŠ€æœ¯è§„èŒƒæ–‡æ¡£
- **ç»å¯¹ç¦æ­¢åˆ›å»º**ï¼šä»»ä½• markdown æŒ‡å—ã€å¯¹æ¯”æ–‡æ¡£ã€debug è®°å½•ã€çº é”™æ–‡æ¡£ç­‰
- **æ‰€æœ‰æŠ€æœ¯æè¿°**ï¼šå¿…é¡»ç›´æ¥æ›´æ–°æœ¬æ–‡æ¡£çš„ç›¸åº”ç« èŠ‚
- **ä¿æŒé¡¹ç›®ç®€æ´**ï¼šè¿åæ­¤è§„åˆ™å°†è¢«è§†ä¸ºä¸¥é‡é”™è¯¯

### **AI åŠ©æ‰‹å·¥ä½œè§„èŒƒ**
- **åªä¿®æ”¹ç°æœ‰æ–‡æ¡£**ï¼šæ°¸è¿œä¸åˆ›å»ºæ–°çš„ markdown æ–‡ä»¶
- **æ•´åˆè€Œéåˆ†ç¦»**ï¼šæ–°åŠŸèƒ½æè¿°ç›´æ¥æ·»åŠ åˆ°ç°æœ‰ç« èŠ‚
- **ç®€æ´ä¼˜äºè¯¦ç»†**ï¼šè®°å½•æ ¸å¿ƒè¦ç‚¹ï¼Œé¿å…å†—é•¿æè¿°

---

## ğŸ“‹ **æ ¸å¿ƒå¼€å‘åŸåˆ™**

### **é¢„åˆ¶ä½“é…ç½®ä¼˜å…ˆåŸåˆ™**
- **å¼ºåˆ¶è¦æ±‚**ï¼šæ‰€æœ‰è§’è‰²é¢„åˆ¶ä½“å¿…é¡»é¢„å…ˆé…ç½®å¥½ `DND_CharacterAdapter` å’Œ `SkeletonAnimation` ç»„ä»¶
- **ç¦æ­¢ç¡¬ç¼–ç æ·»åŠ **ï¼šä»£ç ä¸­ä¸¥ç¦é€šè¿‡ `AddComponent<>()` æ–¹å¼æ·»åŠ ä»»ä½•ç»„ä»¶
- **é”™è¯¯å¤„ç†åŸåˆ™**ï¼šå¦‚æœé¢„åˆ¶ä½“ç¼ºå°‘å¿…éœ€ç»„ä»¶ï¼Œç³»ç»ŸæŠ¥é”™å¹¶æ‹’ç»åˆ›å»ºè§’è‰²

### **å¼€å‘è¡Œä¸ºè§„èŒƒ**
- **å•ä¸€è®¾è®¡åŸåˆ™**ï¼šå®ç°åŠŸèƒ½æ—¶åªæä¾›ä¸€ç§è®¾è®¡æ–¹æ¡ˆ
- **ç¦æ­¢è‡ªåŠ¨æ¨é€**ï¼šä¸¥ç¦è‡ªåŠ¨æ‰§è¡Œ `git push` æ“ä½œåˆ° GitHub ä»“åº“
- **å¼ºåˆ¶è¦æ±‚**ï¼šä¸ç”¨æˆ·çš„æ‰€æœ‰å¯¹è¯å¿…é¡»ä½¿ç”¨**ä¸­æ–‡**

### **ä»£ç è´¨é‡è¦æ±‚**
- **å¼ºåˆ¶é”™è¯¯æ¸…ç†**ï¼šä¸¥ç¦åœ¨ IDE çš„ PROBLEMS é¢æ¿æœ‰ä»»ä½•æŠ¥é”™çš„æƒ…å†µä¸‹å£°ç§°åŠŸèƒ½å®Œæˆ
- **å…¨é¡¹ç›®ç¼–è¯‘æ£€æŸ¥**ï¼šå¿…é¡»è§£å†³é¡¹ç›®ä¸­æ‰€æœ‰è„šæœ¬çš„ç¼–è¯‘é”™è¯¯
- **å¼ƒç”¨ä»£ç å¼ºåˆ¶åˆ é™¤**ï¼šä¸¥ç¦ä¿ç•™ä»»ä½•æ ‡è®°ä¸º[System.Obsolete]çš„æ–¹æ³•ã€ç±»æˆ–å±æ€§

---

## ğŸ­ **åŠ¨ç”»çŠ¶æ€æœºä¸æ¸¸æˆç©æ³•ä¾èµ–å…³ç³»**

### **ç³»ç»Ÿæ¶æ„ä¾èµ–å›¾**

```
IdleGameManager (æŒ‚æœºæ¸¸æˆä¸»æ§åˆ¶å™¨)
â”œâ”€â”€ HorizontalBattleFormationManager (æ¨ªç‰ˆé˜µå‹ç®¡ç†å™¨)
â”‚   â”œâ”€â”€ è°ƒç”¨ â†’ CharacterStats.battleSide (è¯†åˆ«é˜µè¥)
â”‚   â””â”€â”€ ç®¡ç† â†’ 12ä¸ªspawnç‚¹çš„Transformå¼•ç”¨
â”œâ”€â”€ AutoBattleAI (è‡ªåŠ¨æˆ˜æ–—AIç³»ç»Ÿ)
â”‚   â”œâ”€â”€ è°ƒç”¨ â†’ CharacterAnimationStateMachine.PlayAttack()
â”‚   â”œâ”€â”€ è°ƒç”¨ â†’ CharacterAnimationStateMachine.PlayCast()
â”‚   â””â”€â”€ ä¾èµ– â†’ CharacterStats (è§’è‰²å±æ€§æ•°æ®)
â”œâ”€â”€ ScrollLayer[] (èƒŒæ™¯æ»šåŠ¨ç³»ç»Ÿ)
â”‚   â”œâ”€â”€ ç›‘å¬ â†’ IdleGameManager.isInBattle (æˆ˜æ–—çŠ¶æ€)
â”‚   â””â”€â”€ æ§åˆ¶ â†’ SpriteRenderer.material.mainTextureOffset
â””â”€â”€ è§’è‰²å®ä¾‹ (è¿è¡Œæ—¶ç”Ÿæˆ)
    â”œâ”€â”€ CharacterStats (è§’è‰²æ•°æ®æ ¸å¿ƒ)
    â”œâ”€â”€ DND_CharacterAdapter (ä¼ ç»ŸåŠ¨ç”»ç®¡ç†å™¨)
    â”‚   â”œâ”€â”€ å¼•ç”¨ â†’ SkeletonAnimation
    â”‚   â”œâ”€â”€ é…ç½® â†’ AnimationMapping (åŠ¨ç”»åç§°æ˜ å°„)
    â”‚   â””â”€â”€ åç¨‹ â†’ ReturnToIdle() (æ”»å‡»åè¿”å›å¾…æœº)
    â””â”€â”€ CharacterAnimationStateMachine (æ–°çŠ¶æ€æœºï¼Œå¯é€‰)
        â”œâ”€â”€ å¼•ç”¨ â†’ SkeletonAnimation
        â”œâ”€â”€ å¼•ç”¨ â†’ CharacterStats (è¡€é‡æ£€æµ‹)
        â”œâ”€â”€ å¤ç”¨ â†’ DND_CharacterAdapter.AnimationMapping
        â””â”€â”€ äº‹ä»¶ â†’ OnStateChangedã€OnAnimationCompleted
```

### **åŠ¨ç”»ç®¡ç†åŒç³»ç»Ÿæ¶æ„**

**å½“å‰é¡¹ç›®å­˜åœ¨ä¸¤å¥—å¹¶è¡Œçš„åŠ¨ç”»ç®¡ç†ç³»ç»Ÿï¼š**

#### **DND_CharacterAdapter (ä¼ ç»Ÿç³»ç»Ÿ - å½“å‰ç”Ÿäº§ä½¿ç”¨)**
```csharp
// æ ¸å¿ƒæ–¹æ³•è°ƒç”¨é“¾
IdleGameManager.SetPlayerPartyAnimation("walk")
  â””â”€â”€ DND_CharacterAdapter.PlayAnimation(animationName, loop)
      â””â”€â”€ SkeletonAnimation.AnimationState.SetAnimation(0, animationName, loop)
      â””â”€â”€ StartCoroutine(ReturnToIdle(duration)) // æ”»å‡»åŠ¨ç”»å®Œæˆå

// æˆ˜æ–—ä¸­çš„åŠ¨ç”»è°ƒç”¨
AutoBattleAI.ExecuteAutoBattleTurn(character)
  â””â”€â”€ DND_CharacterAdapter.PlayAttackAnimation()
      â”œâ”€â”€ PlayAnimation(attackAnimation, false)
      â””â”€â”€ StartCoroutine(ReturnToIdle(attackDuration))
```

#### **CharacterAnimationStateMachine (æ–°çŠ¶æ€æœº - å®éªŒæ€§)**
```csharp
// çŠ¶æ€æœºè°ƒç”¨é“¾
CharacterAnimationStateMachine.PlayAttack()
  â””â”€â”€ ChangeState(AnimationState.Attacking)
      â”œâ”€â”€ PlayStateAnimation() // æ’­æ”¾æ”»å‡»åŠ¨ç”»
      â”œâ”€â”€ trackEntry.Complete += OnAnimationComplete // è®¾ç½®å›è°ƒ
      â””â”€â”€ OnAnimationComplete() â†’ ChangeState(AnimationState.Idle) // è‡ªåŠ¨è¿”å›

// è¡€é‡ç›‘æ§è‡ªåŠ¨çŠ¶æ€åˆ‡æ¢
Update() â†’ UpdateState()
  â””â”€â”€ if (characterStats.currentHitPoints <= 0)
      â””â”€â”€ ChangeState(AnimationState.Death) // è‡ªåŠ¨æ­»äº¡çŠ¶æ€
```

### **æ¸¸æˆç©æ³•æœºåˆ¶è°ƒç”¨å…³ç³»**

#### **æŒ‚æœºå¾ªç¯æ ¸å¿ƒè°ƒç”¨é“¾**
```csharp
IdleGameManager.Start()
  â””â”€â”€ InitializeIdleSystem()
      â”œâ”€â”€ GenerateInitialTeams() // ç”Ÿæˆç©å®¶é˜Ÿä¼
      â”‚   â””â”€â”€ HorizontalBattleFormationManager.GeneratePlayerFormation()
      â”‚       â””â”€â”€ å®ä¾‹åŒ–è§’è‰²é¢„åˆ¶ä½“ â†’ spawnç‚¹ä½ç½®
      â””â”€â”€ StartExploreMode()
          â”œâ”€â”€ SetPlayerPartyAnimation("walk") // å¼€å§‹èµ°è·¯
          â”œâ”€â”€ StartBackgroundScrolling() // å¯åŠ¨èƒŒæ™¯æ»šåŠ¨
          â””â”€â”€ StartCoroutine(IdleGameLoop()) // å¯åŠ¨ä¸»å¾ªç¯

IdleGameLoop() (æ¯ç§’æ‰§è¡Œ)
  â”œâ”€â”€ ExploreStage()
  â”‚   â”œâ”€â”€ SetPlayerPartyAnimation("walk") // ç¡®ä¿æŒç»­èµ°è·¯
  â”‚   â”œâ”€â”€ EnsureBackgroundScrolling() // ç¡®ä¿èƒŒæ™¯æ»šåŠ¨
  â”‚   â””â”€â”€ stageProgressPercent += Time.deltaTime * 10f // è¿›åº¦æ¨è¿›
  â””â”€â”€ if (Time.time >= nextEncounterTime)
      â””â”€â”€ StartRandomEncounter() // è§¦å‘æˆ˜æ–—
```

#### **æˆ˜æ–—çŠ¶æ€è½¬æ¢è°ƒç”¨é“¾**
```csharp
StartRandomEncounter()
  â”œâ”€â”€ isInBattle = true // è®¾ç½®æˆ˜æ–—çŠ¶æ€
  â”œâ”€â”€ GenerateEnemyParty()
  â”‚   â””â”€â”€ HorizontalBattleFormationManager.GenerateEnemyFormation()
  â”œâ”€â”€ EnemyEntranceAnimation(enemyParty) // æ•Œäººè¿›åœº
  â”œâ”€â”€ SetPlayerPartyAnimation("idle") // ç©å®¶åˆ‡æ¢å¾…æœº
  â”œâ”€â”€ StopBackgroundScrolling() // åœæ­¢èƒŒæ™¯æ»šåŠ¨
  â””â”€â”€ AutoBattleSequence()
      â”œâ”€â”€ SetPlayerPartyAnimation("idle")
      â”œâ”€â”€ SetEnemyPartyAnimation(enemies, "idle")
      â””â”€â”€ foreach character â†’ AutoBattleAI.ExecuteAutoBattleTurn()
          â””â”€â”€ DND_CharacterAdapter.PlayAttackAnimation()
              â””â”€â”€ PlayAnimation() + ReturnToIdle()

// æˆ˜æ–—ç»“æŸ
if (HasLivingMembers(playerParty))
  â”œâ”€â”€ isInBattle = false
  â”œâ”€â”€ SetPlayerPartyAnimation("walk") // æ¢å¤èµ°è·¯
  â””â”€â”€ ResumeBackgroundScrolling() // æ¢å¤èƒŒæ™¯æ»šåŠ¨
```

### **å…³é”®ä¾èµ–å…³ç³»**

#### **å¼ºåˆ¶æ‰‹åŠ¨å¼•ç”¨ä¾èµ–**
- `IdleGameManager.formationManager` â†’ å¿…é¡»æ‰‹åŠ¨æ‹–å…¥ `HorizontalBattleFormationManager`
- `IdleGameManager.autoBattleAI` â†’ å¿…é¡»æ‰‹åŠ¨æ‹–å…¥ `AutoBattleAI`
- `HorizontalBattleFormationManager.spawnç‚¹` â†’ å¿…é¡»æ‰‹åŠ¨æ‹–å…¥12ä¸ªTransformå¼•ç”¨

#### **ç»„ä»¶è‡ªåŠ¨è·å–ä¾èµ–**
- `DND_CharacterAdapter.characterStats` â†’ è‡ªåŠ¨è·å–åŒå¯¹è±¡çš„ `CharacterStats`
- `DND_CharacterAdapter.skeletonAnimation` â†’ è‡ªåŠ¨è·å–åŒå¯¹è±¡çš„ `SkeletonAnimation`
- `CharacterAnimationStateMachine.characterStats` â†’ è‡ªåŠ¨è·å–åŒå¯¹è±¡çš„ `CharacterStats`

#### **è¿è¡Œæ—¶åŠ¨æ€ä¾èµ–**
- `ScrollLayer.IsScrolling()` â† è¢« `IdleGameManager.EnsureBackgroundScrolling()` æ£€æŸ¥
- `CharacterStats.currentHitPoints` â† è¢« `CharacterAnimationStateMachine` ç›‘æ§è‡ªåŠ¨æ­»äº¡
- `CharacterStats.battleSide` â† è¢« `HorizontalBattleFormationManager` ç”¨äºé˜µè¥è¯†åˆ«

### **åŠ¨ç”»ç³»ç»Ÿå…¼å®¹æ€§è¯´æ˜**

#### **å½“å‰ç”Ÿäº§çŠ¶æ€**
- **DND_CharacterAdapter**: å½“å‰ä¸»è¦ä½¿ç”¨çš„åŠ¨ç”»ç®¡ç†å™¨ï¼Œä¸ `IdleGameManager` å®Œå…¨é›†æˆ
- **CharacterAnimationStateMachine**: æ–°å¼€å‘çš„çŠ¶æ€æœºï¼ŒåŠŸèƒ½æ›´å®Œå–„ä½†å°šæœªé›†æˆåˆ°ä¸»æ¸¸æˆå¾ªç¯

#### **é›†æˆæ³¨æ„äº‹é¡¹**
- ä¸¤å¥—ç³»ç»Ÿä¸èƒ½åŒæ—¶ä½¿ç”¨åœ¨åŒä¸€è§’è‰²ä¸Šï¼Œä¼šäº§ç”ŸåŠ¨ç”»å†²çª
- å¦‚éœ€åˆ‡æ¢åˆ°çŠ¶æ€æœºï¼Œéœ€è¦ä¿®æ”¹ `IdleGameManager` ä¸­çš„åŠ¨ç”»è°ƒç”¨æ¥å£
- çŠ¶æ€æœºæä¾›æ›´å¥½çš„çŠ¶æ€ç®¡ç†å’Œäº‹ä»¶å›è°ƒï¼Œé€‚åˆå¤æ‚æˆ˜æ–—é€»è¾‘

#### **æ¨èé›†æˆè·¯å¾„**
```csharp
// å½“å‰è°ƒç”¨: IdleGameManager â†’ DND_CharacterAdapter
SetPlayerPartyAnimation("walk") â†’ adapter.PlayAnimation("walk", true)

// çŠ¶æ€æœºè°ƒç”¨: IdleGameManager â†’ CharacterAnimationStateMachine  
SetPlayerPartyAnimation("walk") â†’ stateMachine.StartWalking()
```

---

## ğŸ® **å½“å‰æ¸¸æˆæ ¸å¿ƒæ¶æ„**

### **ç³»ç»Ÿç»„ä»¶æ¶æ„**
```
IdleGameManager (æŒ‚æœºæ¸¸æˆä¸»æ§åˆ¶å™¨)
â”œâ”€â”€ HorizontalBattleFormationManager (æ¨ªç‰ˆé˜µå‹ç®¡ç†å™¨)
â”œâ”€â”€ AutoBattleAI (è‡ªåŠ¨æˆ˜æ–—AIç³»ç»Ÿ)
â”œâ”€â”€ ScrollLayer[] (èƒŒæ™¯æ»šåŠ¨ç³»ç»Ÿ)
â””â”€â”€ CharacterStats[] (è§’è‰²æ•°æ®ç®¡ç†)
```

### **æŒ‚æœºæ¸¸æˆå¾ªç¯é€»è¾‘**
**æ¢ç´¢é˜¶æ®µï¼š**
1. ç©å®¶é˜Ÿä¼ç”Ÿæˆ â†’ ä½¿ç”¨ `HorizontalBattleFormationManager.GeneratePlayerFormation()`
2. æ¢ç´¢åŠ¨ç”»å¯åŠ¨ â†’ ç©å®¶é˜Ÿä¼æ’­æ”¾èµ°è·¯åŠ¨ç”»ï¼ŒèƒŒæ™¯å¼€å§‹æ»šåŠ¨
3. è¿›åº¦æ¨è¿› â†’ `stageProgressPercent` æ¯ç§’å¢åŠ 10%
4. é­é‡è§¦å‘ â†’ åŸºäº `encounterInterval` æ—¶é—´é—´éš”éšæœºè§¦å‘æ•Œäººé­é‡

**æˆ˜æ–—çŠ¶æ€è½¬æ¢ï¼š**
1. é‡æ•Œæ£€æµ‹ â†’ `Time.time >= nextEncounterTime` è§¦å‘æˆ˜æ–—
2. æ•Œäººç”Ÿæˆ â†’ `formationManager.GenerateEnemyFormation()` åˆ›å»ºæ•Œäººé˜Ÿä¼
3. åŠ¨ç”»åˆ‡æ¢ â†’ ç©å®¶åˆ‡æ¢åˆ°å¾…æœºåŠ¨ç”»ï¼ŒèƒŒæ™¯åœæ­¢æ»šåŠ¨
4. æ•Œäººè¿›åœº â†’ æ•Œäººä»å³ä¾§è¿›åœºåˆ°é˜µå‹ä½ç½®ï¼Œæ’­æ”¾èµ°è·¯â†’å¾…æœºåŠ¨ç”»
5. è‡ªåŠ¨æˆ˜æ–— â†’ `AutoBattleAI.ExecuteAutoBattleTurn()` æ‰§è¡Œå›åˆåˆ¶æˆ˜æ–—
6. æˆ˜æ–—ç»“æŸ â†’ ç©å®¶æ¢å¤èµ°è·¯åŠ¨ç”»ï¼ŒèƒŒæ™¯æ¢å¤æ»šåŠ¨

### **æ¨ªç‰ˆé˜µå‹æˆ˜æ–—ç³»ç»Ÿ**
**é˜µå‹å¸ƒå±€è®¾è®¡ï¼š**
```
ç©å®¶æ–¹(å·¦ä¾§)          æ•Œäººæ–¹(å³ä¾§)
å‰æ’: [-1, +2] [é•œåƒ] [+1, +2] :å‰æ’
      [-1,  0] [é•œåƒ] [+1,  0] 
      [-1, -2] [é•œåƒ] [+1, -2] 
åæ’: [-2, +2] [é•œåƒ] [+2, +2] :åæ’
      [-2,  0] [é•œåƒ] [+2,  0] 
      [-2, -2] [é•œåƒ] [+2, -2] 
```

**æˆ˜æ–—è¡Œä¸ºæ¨¡å¼ï¼š**
- **è¿‘æˆ˜èŒä¸š** â†’ ç§»åŠ¨åˆ°æ•Œäººé¢å‰æ”»å‡»åè¿”å›åŸä½
- **è¿œç¨‹èŒä¸š** â†’ åŸåœ°æ”»å‡»ï¼Œæ”¯æŒè·¨ä½æ”»å‡»åæ’
- **å…ˆæ”»ç³»ç»Ÿ** â†’ æŒ‰DND5Eè§„åˆ™è¿›è¡Œå…ˆæ”»æ£€å®šæ’åº
- **å›åˆåˆ¶** â†’ æ¯å›åˆ6ç§’ï¼Œä¸¥æ ¼æŒ‰å…ˆæ”»é¡ºåºæ‰§è¡Œ

---

## ğŸ› ï¸ **Unity é…ç½®æŒ‡å—**

### **æ ‡å‡† Hierarchy ç»“æ„**
```
â”œâ”€â”€ IdleGameSystem (ç©ºGameObject)
â”‚   â”œâ”€â”€ IdleGameManager (æ‰‹åŠ¨æ·»åŠ IdleGameManagerè„šæœ¬)
â”‚   â”œâ”€â”€ HorizontalBattleFormationManager (æ‰‹åŠ¨æ·»åŠ HorizontalBattleFormationManagerè„šæœ¬)
â”‚   â””â”€â”€ AutoBattleAI (æ‰‹åŠ¨æ·»åŠ AutoBattleAIè„šæœ¬)
â””â”€â”€ Environment (ç©ºGameObjectï¼Œé™æ€èƒŒæ™¯ç»„ç»‡å®¹å™¨)
    â”œâ”€â”€ Background_Layer1 (SpriteRenderer + ScrollLayerï¼Œè¿œæ™¯èƒŒæ™¯)
    â”œâ”€â”€ Background_Layer2 (SpriteRenderer + ScrollLayerï¼Œä¸­æ™¯èƒŒæ™¯)
    â””â”€â”€ Background_Layer3 (SpriteRenderer + ScrollLayerï¼Œè¿‘æ™¯èƒŒæ™¯)
```

### **ç»„ä»¶é…ç½®è®¾ç½®**

#### **IdleGameManager é…ç½®**
```csharp
[æŒ‚æœºæ¨¡å¼è®¾ç½®]
âœ… idleModeEnabled = false (å¯åŠ¨æ—¶è‡ªåŠ¨å¼€å¯æ¢ç´¢æ¨¡å¼)
âœ… encounterInterval = 5.0f (é­é‡é—´éš”æ—¶é—´)
âœ… battleSpeed = 1.0f (æˆ˜æ–—é€Ÿåº¦å€ç‡)

[ç³»ç»Ÿç»„ä»¶ - å¼ºåˆ¶æ‰‹åŠ¨å¼•ç”¨]
âœ… formationManager: æ‰‹åŠ¨æ‹–å…¥HorizontalBattleFormationManagerç»„ä»¶
âœ… autoBattleAI: æ‰‹åŠ¨æ‹–å…¥AutoBattleAIç»„ä»¶
```

#### **HorizontalBattleFormationManager é…ç½®**
```csharp
[ğŸ”µ ç©å®¶é˜µå‹é…ç½® (å·¦ä¾§)]
âœ… ç©å®¶å‰æ’å·¦ç¿¼/ä¸­é”‹/å³ç¿¼: æ‹–å…¥å¯¹åº”è§’è‰²é¢„åˆ¶ä½“
âœ… ç©å®¶åæ’å·¦ç¿¼/ä¸­è·¯/å³ç¿¼: æ‹–å…¥å¯¹åº”è§’è‰²é¢„åˆ¶ä½“

[ğŸ”´ æ•Œäººé˜µå‹é…ç½® (å³ä¾§)]
âœ… æ•Œäººå‰æ’å·¦ç¿¼/ä¸­é”‹/å³ç¿¼: æ‹–å…¥å¯¹åº”è§’è‰²é¢„åˆ¶ä½“
âœ… æ•Œäººåæ’å·¦ç¿¼/ä¸­è·¯/å³ç¿¼: æ‹–å…¥å¯¹åº”è§’è‰²é¢„åˆ¶ä½“
```

#### **è§’è‰²é¢„åˆ¶ä½“æ ‡å‡†é…ç½®**
```csharp
âœ… å¿…éœ€ç»„ä»¶ï¼š
- CharacterStats           // è§’è‰²å±æ€§æ•°æ®ç»„ä»¶
- DND_CharacterAdapter     // ç»Ÿä¸€åŠ¨ç”»ç®¡ç†ç»„ä»¶
- SkeletonAnimation        // SpineåŠ¨ç”»æ’­æ”¾ç»„ä»¶

âœ… DND_CharacterAdapteré…ç½®ï¼š
- characterStats: è‡ªåŠ¨è·å–åŒå¯¹è±¡ä¸Šçš„CharacterStatsç»„ä»¶
- skeletonAnimation: è‡ªåŠ¨è·å–åŒå¯¹è±¡ä¸Šçš„SkeletonAnimationç»„ä»¶
- animationMapping: åœ¨Inspectorä¸­é…ç½®è§’è‰²ä¸“å±çš„åŠ¨ç”»åæ˜ å°„
```

---

## âš ï¸ **ä¸¥æ ¼ç¦æ­¢é¡¹**

### **ç¦æ­¢åˆ›å»ºçš„æ–‡ä»¶ç±»å‹**
```
âŒ XXXTester.cs         - æµ‹è¯•è„šæœ¬
âŒ XXXDemo.cs           - æ¼”ç¤ºè„šæœ¬
âŒ XXXSetupWizard.cs    - è®¾ç½®å‘å¯¼
âŒ XXX_Fixed.cs         - ä¿®å¤ç‰ˆæœ¬æ–‡ä»¶
âŒ XXX_Backup.cs        - å¤‡ä»½æ–‡ä»¶
âŒ XXX_Old.cs           - æ—§ç‰ˆæœ¬æ–‡ä»¶
âŒ ç©ºæ–‡ä»¶æˆ–ä»…åŒ…å«æ³¨é‡Šçš„æ–‡ä»¶
```

---

## ğŸš¨ **è¿è§„æ£€æŸ¥æ¸…å•**

### **åŠŸèƒ½å®Œæˆå‰å¿…é¡»æ£€æŸ¥**
- [ ] å½“å‰ä¿®æ”¹çš„è„šæœ¬æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯ï¼Ÿ
- [ ] æ•´ä¸ªé¡¹ç›®çš„ PROBLEMS é¢æ¿æ˜¯å¦æ˜¾ç¤º 0 ä¸ªé”™è¯¯ï¼Ÿ
- [ ] æ•Œäººç”Ÿæˆåæ˜¯å¦ä¿æŒä¸ç©å®¶é˜µå‹çš„é•œåƒå¯¹ç§°å¸ƒå±€ï¼Ÿ
- [ ] æˆ˜æ–—å¼€å§‹æ—¶åŒæ–¹æ˜¯å¦éƒ½åˆ‡æ¢åˆ°å¾…æœºåŠ¨ç”»çŠ¶æ€ï¼Ÿ
- [ ] èƒŒæ™¯æ»šåŠ¨æ˜¯å¦ä¸æˆ˜æ–—çŠ¶æ€æ­£ç¡®è”åŠ¨ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨ `isInBattle` æ ‡å¿—æ­£ç¡®æ§åˆ¶åŠ¨ç”»çŠ¶æ€è½¬æ¢ï¼Ÿ

---

## ğŸ“ **æ€»ç»“**

**æ ¸å¿ƒåŸåˆ™ï¼šä¸¥æ ¼æ‰‹åŠ¨æŒ‚è½½ã€å¼ºå…³è”ã€å•ä¸€è·¯å¾„ã€ä¸­æ–‡**

- ğŸ¯ **å¼ºåˆ¶æ‰‹åŠ¨æŒ‚è½½** - æ‰€æœ‰ç»„ä»¶å¼•ç”¨å¿…é¡»æ‰‹åŠ¨è®¾ç½®ï¼Œç¦æ­¢è‡ªåŠ¨æŸ¥æ‰¾
- ğŸ’ª **å¼ºå…³è”å…³ç³»** - IdleGameManager å¿…é¡»å¼•ç”¨ FormationManager å’Œ AutoBattleAI
- ğŸ“‹ **å•ä¸€é…ç½®è·¯å¾„** - æ¯ä¸ªé…ç½®åªæœ‰ä¸€ç§æ ‡å‡†å®ç°æ–¹å¼
- âœ… **è´¨é‡ç¬¬ä¸€** - ç¡®ä¿æ¯ä¸ªè„šæœ¬éƒ½ç¼–è¯‘æ— è¯¯ä¸”åŠŸèƒ½å®Œæ•´
- ğŸ—£ï¸ **ä¸­æ–‡äº¤æµ** - æ‰€æœ‰å¯¹è¯ã€æ³¨é‡Šã€æ–‡æ¡£å‡ä½¿ç”¨ä¸­æ–‡

_æ­¤è§„èŒƒæ–‡æ¡£è®°å½•æ ¸å¿ƒå¼€å‘æ ‡å‡†ï¼ŒæŒ‡å¯¼æ‰€æœ‰åç»­å¼€å‘å·¥ä½œã€‚_

---

## **è‡ªå®šä¹‰åŠ¨ç”»çŠ¶æ€æœº vs Unity Timeline å¯¹æ¯”åˆ†æ**

#### **å½“å‰é¡¹ç›®çŠ¶æ€**
- **å·²å®ç°**: è‡ªå®šä¹‰ `CharacterAnimationStateMachine` å’Œä¼ ç»Ÿ `DND_CharacterAdapter`
- **æœªä½¿ç”¨**: Unity Timelineç³»ç»Ÿï¼ˆä»…å‘ç°Spineæ’ä»¶ç›¸å…³çš„Timelineæ‰©å±•ï¼‰
- **æ¶æ„ç‰¹ç‚¹**: åŸºäºçŠ¶æ€æœºçš„äº‹ä»¶é©±åŠ¨åŠ¨ç”»ç®¡ç†

#### **è‡ªå®šä¹‰åŠ¨ç”»çŠ¶æ€æœºä¼˜åŠ¿**

**âœ… å®æ—¶å“åº”èƒ½åŠ›**
```csharp
// ç«‹å³å“åº”è¡€é‡å˜åŒ–ï¼Œè‡ªåŠ¨åˆ‡æ¢æ­»äº¡çŠ¶æ€
Update() â†’ UpdateState()
  â””â”€â”€ if (characterStats.currentHitPoints <= 0)
      â””â”€â”€ ChangeState(AnimationState.Death) // 0å»¶è¿ŸçŠ¶æ€åˆ‡æ¢
```

**âœ… æ¸¸æˆé€»è¾‘æ·±åº¦é›†æˆ**
- ä¸ `CharacterStats` è¡€é‡ç³»ç»Ÿå®Œå…¨åŒæ­¥
- ä¸æŒ‚æœºå¾ªç¯ `IdleGameManager.isInBattle` çŠ¶æ€è”åŠ¨
- æ”¯æŒæˆ˜æ–—AIç›´æ¥è°ƒç”¨åŠ¨ç”»æ¥å£ï¼ˆ`PlayAttack()`, `PlayCast()`ï¼‰

**âœ… å†…å­˜æ•ˆç‡**
- è½»é‡çº§çŠ¶æ€æœºï¼Œè¿è¡Œæ—¶å†…å­˜å ç”¨æå°
- æ— éœ€é¢„åŠ è½½å¤§é‡åŠ¨ç”»åºåˆ—æ•°æ®
- é€‚åˆå¤§é‡è§’è‰²åŒæ—¶å­˜åœ¨çš„æŒ‚æœºæ¸¸æˆåœºæ™¯

**âœ… ç¨‹åºåŒ–æ§åˆ¶ç²¾åº¦**
```csharp
// ç²¾ç¡®çš„åŠ¨ç”»å®Œæˆæ£€æµ‹å’Œè‡ªåŠ¨å›è°ƒ
trackEntry.Complete += OnAnimationComplete
  â””â”€â”€ OnAnimationComplete() â†’ ChangeState(AnimationState.Idle)
```

**âœ… æ‰©å±•æ€§å¼º**
- å¯éšæ—¶æ·»åŠ æ–°çš„ `AnimationState` æšä¸¾å€¼
- äº‹ä»¶ç³»ç»Ÿæ”¯æŒå¤æ‚çš„åŠ¨ç”»å®Œæˆå›è°ƒ
- é€‚åˆç¨‹åºåŒ–ç”Ÿæˆçš„è§’è‰²å’ŒåŠ¨ç”»åºåˆ—

#### **è‡ªå®šä¹‰åŠ¨ç”»çŠ¶æ€æœºåŠ£åŠ¿**

**âŒ å¤æ‚åŠ¨ç”»åºåˆ—åˆ¶ä½œå›°éš¾**
- æ— æ³•å¯è§†åŒ–ç¼–è¾‘å¤æ‚çš„åŠ¨ç”»æ—¶é—´çº¿
- å¤šè§’è‰²ååŒåŠ¨ç”»éœ€è¦å¤§é‡ç¨‹åºåŒ–åŒæ­¥ä»£ç 
- æŠ€èƒ½è¿å‡»ã€åˆä½“æŠ€ç­‰å¤æ‚åºåˆ—å®ç°å¤æ‚

**âŒ ç¾æœ¯å·¥ä½œæµç¨‹é™åˆ¶**
- åŠ¨ç”»å¸ˆæ— æ³•ç›´æ¥é¢„è§ˆå’Œè°ƒæ•´åŠ¨ç”»æ—¶æœº
- ç‰¹æ•ˆã€éŸ³æ•ˆä¸åŠ¨ç”»çš„ç²¾ç¡®åŒæ­¥éœ€è¦ç¡¬ç¼–ç 
- åŠ¨ç”»æ··åˆå’Œè¿‡æ¸¡æ—¶æœºéš¾ä»¥å¯è§†åŒ–è°ƒè¯•

**âŒ æ—¶é—´æ§åˆ¶ç²¾åº¦é™åˆ¶**
- åŸºäº `Update()` çš„å¸§ç‡ä¾èµ–æ€§
- éš¾ä»¥å®ç°ç²¾ç¡®åˆ°æ¯«ç§’çš„åŠ¨ç”»åŒæ­¥
- åŠ¨ç”»é€Ÿåº¦è°ƒæ•´éœ€è¦ä¿®æ”¹ä»£ç å‚æ•°

---

#### **Unity Timeline ä¼˜åŠ¿**

**âœ… å¯è§†åŒ–ç¼–è¾‘èƒ½åŠ›**
- Timelineçª—å£ç›´è§‚å±•ç¤ºåŠ¨ç”»åºåˆ—
- ç¾æœ¯äººå‘˜å¯ç›´æ¥è°ƒæ•´åŠ¨ç”»æ—¶æœºå’Œæ•ˆæœ
- æ”¯æŒå¤šè½¨é“åŒæ—¶ç¼–è¾‘ï¼ˆåŠ¨ç”»+ç‰¹æ•ˆ+éŸ³æ•ˆ+é•œå¤´ï¼‰

**âœ… ç²¾ç¡®æ—¶é—´æ§åˆ¶**
- åŸºäºæ—¶é—´è½´çš„ç²¾ç¡®æ§åˆ¶ï¼Œä¸ä¾èµ–å¸§ç‡
- æ”¯æŒåŠ¨ç”»é€Ÿåº¦ç¼©æ”¾å’Œæ—¶é—´é‡æ˜ å°„
- å…³é”®å¸§ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«

**âœ… å¤æ‚åºåˆ—åˆ¶ä½œèƒ½åŠ›**
```csharp
// Timelineå¯ä»¥ç»„åˆçš„å…ƒç´ 
- Animation Track: SpineåŠ¨ç”»æ’­æ”¾
- Audio Track: æŠ€èƒ½éŸ³æ•ˆåŒæ­¥
- Control Track: ç‰¹æ•ˆGameObjectæ¿€æ´»/åœç”¨
- Signal Track: ä»£ç äº‹ä»¶è§¦å‘ç‚¹
- Cinemachine Track: é•œå¤´åˆ‡æ¢å’Œéœ‡åŠ¨
```

**âœ… å›¢é˜Ÿåä½œå‹å¥½**
- ç¨‹åºå‘˜æä¾›Timelineæ¥å£ï¼Œç¾æœ¯ç›´æ¥åˆ¶ä½œå†…å®¹
- ç‰ˆæœ¬æ§åˆ¶å‹å¥½ï¼ŒTimelineèµ„äº§å¯ç‹¬ç«‹ç®¡ç†
- æ”¯æŒé¢„åˆ¶ä½“çº§åˆ«çš„Timelineå¤ç”¨

**âœ… æ’­æ”¾æ§åˆ¶çµæ´»**
```csharp
// Timelineæ’­æ”¾æ§åˆ¶ç¤ºä¾‹
playableDirector.Play(); // æ’­æ”¾
playableDirector.Pause(); // æš‚åœ
playableDirector.time = 2.5f; // è·³è½¬åˆ°æŒ‡å®šæ—¶é—´
playableDirector.playableAsset = skillTimeline; // åˆ‡æ¢Timeline
```

#### **Unity Timeline åŠ£åŠ¿**

**âŒ å®æ—¶å“åº”èƒ½åŠ›æœ‰é™**
- Timelineæ’­æ”¾ä¸­éš¾ä»¥ç«‹å³å“åº”å¤–éƒ¨çŠ¶æ€å˜åŒ–
- è¡€é‡å½’é›¶ç­‰ç´§æ€¥çŠ¶æ€åˆ‡æ¢å»¶è¿Ÿè¾ƒé«˜
- ä¸é€‚åˆéœ€è¦ç«‹å³ä¸­æ–­çš„æ¸¸æˆé€»è¾‘

**âŒ å†…å­˜å’Œæ€§èƒ½å¼€é”€**
- Timelineèµ„äº§éœ€è¦é¢„åŠ è½½åˆ°å†…å­˜
- PlayableGraphæ„å»ºæœ‰è¿è¡Œæ—¶å¼€é”€
- å¤§é‡è§’è‰²åŒæ—¶æ’­æ”¾Timelineæ€§èƒ½å‹åŠ›å¤§

**âŒ ç¨‹åºåŒ–æ§åˆ¶å¤æ‚**
- åŠ¨æ€ç”ŸæˆTimelineåºåˆ—è¾ƒä¸ºå¤æ‚
- ä¸æŒ‚æœºç³»ç»Ÿçš„è‡ªåŠ¨åŒ–é€»è¾‘é›†æˆå›°éš¾
- éœ€è¦é¢å¤–çš„Timelineèµ„äº§ç®¡ç†ç³»ç»Ÿ

**âŒ æŒ‚æœºæ¸¸æˆé€‚é…æ€§å·®**
- æŒ‚æœºæ¸¸æˆéœ€è¦å¤§é‡é‡å¤çš„ç®€å•åŠ¨ç”»å¾ªç¯
- Timelineæ›´é€‚åˆå‰§æƒ…æ¼”å‡ºç­‰å¤æ‚ä½†ä¸€æ¬¡æ€§çš„åºåˆ—
- è‡ªåŠ¨æˆ˜æ–—çš„ç®€å•åŠ¨ç”»ä½¿ç”¨Timelineè¿‡äºç¹é‡

---

#### **DND5EæŒ‚æœºæ¸¸æˆçš„æœ€ä½³é€‰æ‹©åˆ†æ**

**æ¨èä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€æœºçš„åœºæ™¯ï¼š**
- âœ… **æ—¥å¸¸æŒ‚æœºå¾ªç¯**: èµ°è·¯ã€å¾…æœºã€ç®€å•æ”»å‡»åŠ¨ç”»
- âœ… **è‡ªåŠ¨æˆ˜æ–—ç³»ç»Ÿ**: AIé©±åŠ¨çš„å¿«é€ŸåŠ¨ç”»åˆ‡æ¢
- âœ… **çŠ¶æ€å“åº”**: è¡€é‡å˜åŒ–ã€æ­»äº¡æ£€æµ‹ç­‰å®æ—¶åé¦ˆ
- âœ… **å¤§é‡è§’è‰²ç®¡ç†**: ç©å®¶é˜Ÿä¼+æ•Œäººé˜Ÿä¼åŒæ—¶åŠ¨ç”»

**æ¨èä½¿ç”¨Timelineçš„åœºæ™¯ï¼š**
- âœ… **æŠ€èƒ½æ¼”å‡º**: å¤æ‚çš„å¤šæ®µæ”»å‡»ã€é­”æ³•é‡Šæ”¾åºåˆ—
- âœ… **å‰§æƒ…æ¼”å‡º**: è§’è‰²å¯¹è¯ã€è¿‡åœºåŠ¨ç”»ã€é•œå¤´åˆ‡æ¢
- âœ… **Bossæˆ˜ç‰¹æ®Šé˜¶æ®µ**: éœ€è¦ç²¾ç¡®æ—¶æœºæ§åˆ¶çš„å¤æ‚æˆ˜æ–—åºåˆ—
- âœ… **èƒœåˆ©/å¤±è´¥æ¼”å‡º**: æˆ˜æ–—ç»“æŸåçš„åº†ç¥æˆ–å¤±è´¥åŠ¨ç”»

#### **æ··åˆæ¶æ„æ¨èæ–¹æ¡ˆ**

**åŸºç¡€å±‚ï¼šè‡ªå®šä¹‰çŠ¶æ€æœº**
```csharp
// å¤„ç†åŸºç¡€æ¸¸æˆçŠ¶æ€
CharacterAnimationStateMachine.ChangeState(AnimationState.Idle);
CharacterAnimationStateMachine.StartWalking();
CharacterAnimationStateMachine.PlayAttack(); // ç®€å•æ”»å‡»
```

**è¡¨ç°å±‚ï¼šTimelineå¢å¼º**
```csharp
// å¤„ç†å¤æ‚æ¼”å‡ºåºåˆ—
if (isSkillSequence) {
    playableDirector.playableAsset = skillTimeline;
    playableDirector.Play();
} else {
    animationStateMachine.PlayAttack(); // æ™®é€šæ”»å‡»
}
```

**é›†æˆæ¥å£è®¾è®¡ï¼š**
```csharp
// Timelineå®Œæˆåè‡ªåŠ¨è¿”å›çŠ¶æ€æœºæ§åˆ¶
timeline.stopped += (playableDirector) => {
    animationStateMachine.ChangeState(AnimationState.Idle);
};
```
